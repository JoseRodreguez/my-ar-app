<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Trace Pro (Basic)</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: sans-serif; }
        
        /* Video and Snapshot layers */
        #video, #snapshot {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: cover;
            z-index: 1;
        }
        #snapshot { display: none; } /* Hidden until locked */

        /* The Image to Trace */
        #stencil {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            max-width: 80%;
            opacity: 0.5;
            z-index: 2;
            pointer-events: none;
        }

        /* UI Panel */
        #ui {
            position: fixed;
            bottom: 20px; left: 50%;
            transform: translateX(-50%);
            z-index: 3;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 85%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .row { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        button { 
            flex: 1; padding: 10px; border: none; border-radius: 8px; 
            font-weight: bold; cursor: pointer; color: white;
        }
        #lockBtn { background: #4a90e2; }
        #lockBtn.active { background: #e74c3c; }
        
        input[type="range"] { flex: 2; }
        label { font-size: 11px; text-transform: uppercase; color: #555; }
    </style>
</head>
<body>

<video id="video" autoplay playsinline></video>
<canvas id="hiddenCanvas" style="display:none;"></canvas>
<img id="snapshot">
<img id="stencil" src="https://via.placeholder.com/300?text=Upload+Image">

<div id="ui">
    <div class="row">
        <button id="lockBtn">ðŸ”’ LOCK FRAME</button>
        <input type="file" id="fileInput" accept="image/*" style="display:none">
        <button onclick="document.getElementById('fileInput').click()" style="background:#2ecc71">ðŸ“‚ IMAGE</button>
    </div>
    
    <div class="row">
        <label>Opacity</label>
        <input type="range" id="opacitySlider" min="0" max="1" step="0.01" value="0.5">
    </div>

    <div class="row">
        <label>Size</label>
        <input type="range" id="sizeSlider" min="10" max="200" value="80">
    </div>
</div>

<script>
    const video = document.getElementById('video');
    const snapshot = document.getElementById('snapshot');
    const canvas = document.getElementById('hiddenCanvas');
    const stencil = document.getElementById('stencil');
    const lockBtn = document.getElementById('lockBtn');
    
    let isLocked = false;

    // 1. Camera Access
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(stream => { video.srcObject = stream; })
        .catch(err => alert("Camera error: " + err));

    // 2. The "Lock" Logic
    lockBtn.addEventListener('click', () => {
        if (!isLocked) {
            // Take a "Photo" of the current video frame
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            // Show the photo, hide the live video
            snapshot.src = canvas.toDataURL('image/webp');
            snapshot.style.display = 'block';
            video.style.display = 'none';
            
            lockBtn.textContent = "ðŸ”“ UNLOCK (LIVE)";
            lockBtn.classList.add('active');
            isLocked = true;
        } else {
            // Return to live video
            snapshot.style.display = 'none';
            video.style.display = 'block';
            lockBtn.textContent = "ðŸ”’ LOCK FRAME";
            lockBtn.classList.remove('active');
            isLocked = false;
        }
    });

    // 3. Sliders & File Upload
    document.getElementById('opacitySlider').oninput = (e) => stencil.style.opacity = e.target.value;
    document.getElementById('sizeSlider').oninput = (e) => stencil.style.maxWidth = e.target.value + '%';
    document.getElementById('fileInput').onchange = (e) => {
        const file = e.target.files[0];
        if (file) stencil.src = URL.createObjectURL(file);
    };
</script>

</body>
</html>